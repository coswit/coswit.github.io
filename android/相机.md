





### YUV图

##### 参考

[图文详解YUV420数据格式](https://www.cnblogs.com/azraelly/archive/2013/01/01/2841269.html)



### 相机旋转

#### 相机预览旋转角度

1. 传感器在安装时就和屏幕竖直方向存在夹角(orientation)，大部分手机为90度

   安装角度：手机自然状态下的上方向与摄像头的上方向的夹角，方向是从摄像头的上方向逆时针旋转到手机的上方向

2. 手机会横竖屏切换，导致手机屏幕的上方向和手机物理的上方向也有一个角度(rotation)。



官方方法

```java
 	if (deviceOrientation == android.view.OrientationEventListener.ORIENTATION_UNKNOWN)
            return 0;
        int sensorOrientation = c.get(CameraCharacteristics.SENSOR_ORIENTATION);

        // Round device orientation to a multiple of 90
        deviceOrientation = (deviceOrientation + 45) / 90 * 90;

        // Reverse device orientation for front-facing cameras
        boolean facingFront = c.get(CameraCharacteristics.LENS_FACING) == CameraCharacteristics.LENS_FACING_FRONT;
        if (facingFront) deviceOrientation = -deviceOrientation;

        // Calculate desired JPEG orientation relative to camera orientation to make
        // the image upright relative to the device orientation
        int jpegOrientation = (sensorOrientation + deviceOrientation + 360) % 360;
```

相机预览计算，sign前置摄像头1，后置摄像头-1

```java
rotation = (sensorOrientationDegrees - deviceOrientationDegrees * sign + 360) % 360
```

##### 参考

[Android相机开发 - 预览画面的旋转](https://zhuanlan.zhihu.com/p/110944780)

[CameraX 用例旋转  | Android 开发者  | Android Developers](https://developer.android.com/training/camerax/orientation-rotation?hl=zh-cn)

[Camera  | Android Developers](https://developer.android.com/reference/android/hardware/Camera#setDisplayOrientation(int))

[android - Camera2 understanding the sensor and device orientations - Stack Overflow](https://stackoverflow.com/questions/48406497/camera2-understanding-the-sensor-and-device-orientations)



 

|                                     | 图片实际应该旋转 | 手机Surface.ROTATION | 平板Surface.ROTATION | 相机传递图片对应旋转角度 |
| :---------------------------------: | :--------------: | :------------------: | :------------------: | :----------------------: |
|                竖屏                 |        0         |  Surface.ROTATION_0  |  Surface.ROTATION_0  |      手机0，平板90       |
| 反向竖屏<br/>(手机被锁定为正向竖屏) |       180        |  Surface.ROTATION_0  | Surface.ROTATION_180 |     手机180，平板270     |
|                横屏                 |       270        | Surface.ROTATION_90  | Surface.ROTATION_90  |      手机270，平板0      |
|              反向横屏               |        90        | Surface.ROTATION_270 | Surface.ROTATION_270 |     手机90，平板180      |

